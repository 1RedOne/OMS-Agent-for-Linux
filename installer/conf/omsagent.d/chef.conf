<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/bookshelf/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-bookshelf.pos
  read_from_head true
  tag oms.api.chef_bookshelf.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/chef-expander/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-expander.pos
  read_from_head true
  tag oms.api.chef_expander.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/chef-pedant/http-traffic.log
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-pedant-http-traffic.pos
  read_from_head true
  tag oms.api.chef_pedant_http_traffic.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/chef-server-webui/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-server-webui.pos
  read_from_head true
  tag oms.api.chef_server_webui.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/chef-solr/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-solr.pos
  read_from_head true
  tag oms.api.chef_solr.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/erchef/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-erchef-current.pos
  read_from_head true
  tag oms.api.chef_erchef_current.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/erchef/erchef.log.1
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-erchef.pos
  read_from_head true
  tag oms.api.chef_erchef.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/nginx/access.log
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-nginx-access.pos
  read_from_head true
  tag oms.api.chef_nginx_access.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/nginx/error.log
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-nginx-error.pos
  read_from_head true
  tag oms.api.chef_nginx_error.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/nginx/rewrite-port-80.log
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-nginx-rewrite-port-80.pos
  read_from_head true
  tag oms.api.chef_nginx_rewrite_port.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/postgresql/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-postgresql.pos
  read_from_head true
  tag oms.api.chef_postgresql.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/chef-server/rabbitmq/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_chef-rabbitmq.pos
  read_from_head true
  tag oms.api.chef_rabbitmq.Timestamp
</source>

<filter oms.api.chef**>
  type record_transformer
  enable_ruby
  <record>
    Computer ${OMS::Common.get_hostname}
    Timestamp ${DateTime.parse(record["Timestamp"]).strftime("%FT%H:%M:%S.%3NZ")}
  </record>
</filter>