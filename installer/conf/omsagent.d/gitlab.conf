<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/gitaly/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_gitaly.pos
  read_from_head true
  tag oms.api.gitlab_gitaly.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/gitlab-rails/application.log
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_application.pos
  read_from_head true
  tag oms.api.gitlab_application.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/gitlab-rails/production.log
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_production.pos
  read_from_head true
  tag oms.api.gitlab_production.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/gitlab-workhorse/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_workhorse.pos
  read_from_head true
  tag oms.api.gitlab_workhorse.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/nginx/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_nginx.pos
  read_from_head true
  tag oms.api.gitlab_nginx.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/nginx/access.log
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_access.pos
  read_from_head true
  tag oms.api.gitlab_access.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/nginx/error.log
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_error.pos
  read_from_head true
  tag oms.api.gitlab_error.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/postgres-exporter/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_exporter.pos
  read_from_head true
  tag oms.api.gitlab_exporter.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/prometheus/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_prometheus.pos
  read_from_head true
  tag oms.api.gitlab_prometheus.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/redis/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_redis.pos
  read_from_head true
  tag oms.api.gitlab_redis.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/sidekiq/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_sidekiq.pos
  read_from_head true
  tag oms.api.gitlab_sidekiq.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/gitlab-monitor/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_monitor.pos
  read_from_head true
  tag oms.api.gitlab_monitor.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/gitlab-shell/gitlab-shell.log
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_shell.pos
  read_from_head true
  tag oms.api.gitlab_shell.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/logrotate/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_logrotate.pos
  read_from_head true
  tag oms.api.gitlab_logrotate.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/node-exporter/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_exporter.pos
  read_from_head true
  tag oms.api.gitlab_exporter.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/postgresql/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_postgresql.pos
  read_from_head true
  tag oms.api.gitlab_postgresql.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/redis-exporter/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_exporter.pos
  read_from_head true
  tag oms.api.gitlab_exporter.Timestamp
</source>

<source>
  type tail
  format /^(?<Timestamp>\d{4}\-\d{1,2}\-\d{1,2}\_\d{1,2}:\d{1,2}:\d{1,2}.\d{2,5})(?<Message>.*)$/
  time_format %Y-%m-%d_%H:%M:%S
  path /var/log/gitlab/unicorn/current
  pos_file /var/opt/microsoft/omsagent/state/out_oms_api_gitlab_unicorn.pos
  read_from_head true
  tag oms.api.gitlab_unicorn.Timestamp
</source>

<filter oms.api.gitlab**>
  type record_transformer
  enable_ruby
  <record>
    Computer ${OMS::Common.get_hostname}
    Timestamp ${DateTime.parse(record["Timestamp"]).strftime("%FT%H:%M:%S.%3NZ")}
  </record>
</filter>